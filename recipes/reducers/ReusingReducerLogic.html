<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<title>Reusing Reducer Logic - Redux Documents</title>
<meta name="description" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../assets/css/bulma.min.css">
<link rel="stylesheet" href="../../assets/css/app.css">
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="shortcut icon" href="">
</head>
<body>

<nav class="columns navbar">
  <div class="column logo is-3 is-offset-1">
    <a class="is-brand" href="../../index.html">
      Redux Documents
    </a>
  </div>
</nav>

<div class="book-toc notification is-warning is-hidden">
  <h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close </a></span></h3>
  <ul class="chapter-area"><li class="chapter-item "><a href="../../introduction/index.html">introduction</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item "><a href="../../introduction/Motivation.html">Motivation</a></li><li class="chapter-item "><a href="../../introduction/ThreePrinciples.html">Three Principles</a></li><li class="chapter-item "><a href="../../introduction/PriorArt.html">Prior Art</a></li><li class="chapter-item "><a href="../../introduction/CoreConcepts.html">Core Concepts</a></li><li class="chapter-item "><a href="../../introduction/Ecosystem.html">Ecosystem</a></li><li class="chapter-item "><a href="../../introduction/Examples.html">Examples</a></li></ul><li class="chapter-item "><a href="../../basics/index.html">basics</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item "><a href="../../basics/Actions.html">Actions</a></li><li class="chapter-item "><a href="../../basics/Reducers.html">Reducers</a></li><li class="chapter-item "><a href="../../basics/Store.html">Store</a></li><li class="chapter-item "><a href="../../basics/DataFlow.html">Data Flow</a></li><li class="chapter-item "><a href="../../basics/UsageWithReact.html">Usage with React</a></li><li class="chapter-item "><a href="../../basics/ExampleTodoList.html">Example: Todo List</a></li></ul><li class="chapter-item "><a href="../../advanced/index.html">advanced</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item "><a href="../../advanced/AsyncActions.html">Async Actions</a></li><li class="chapter-item "><a href="../../advanced/AsyncFlow.html">Async Flow</a></li><li class="chapter-item "><a href="../../advanced/ExampleRedditAPI.html">Example: Reddit API</a></li><li class="chapter-item "><a href="../../advanced/Middleware.html">Middleware</a></li><li class="chapter-item "><a href="../../advanced/NextSteps.html">Next Steps</a></li><li class="chapter-item "><a href="../../advanced/UsageWithReactRouter.html">Usage with React Router</a></li></ul><li class="chapter-item "><a href="../../recipes/index.html">recipes</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item "><a href="../../recipes/ComputingDerivedData.html">Computing Derived Data</a></li><li class="chapter-item "><a href="../../recipes/ImplementingUndoHistory.html">Implementing Undo History</a></li><li class="chapter-item "><a href="../../recipes/IsolatingSubapps.html">Isolating Redux Sub-Apps</a></li><li class="chapter-item "><a href="../../recipes/MigratingToRedux.html">Migrating to Redux</a></li><li class="chapter-item "><a href="../../recipes/ReducingBoilerplate.html">Reducing Boilerplate</a></li><li class="chapter-item "><a href="../../recipes/ServerRendering.html">Server Rendering</a></li><li class="chapter-item "><a href="../../recipes/StructuringReducers.html">Structuring Reducers</a></li><li class="chapter-item "><a href="../../recipes/UsingObjectSpreadOperator.html">Using Object Spread Operator</a></li><li class="chapter-item "><a href="../../recipes/WritingTests.html">Writing Tests</a></li><li class="chapter-item "><a href="../../recipes/reducers/index.html">reducers</a></li><ul class="chapter-level-2"><li class="chapter-item "><a href="../../recipes/reducers/BasicReducerStructure.html">Basic Reducer Structure and State Shape</a></li><li class="chapter-item "><a href="../../recipes/reducers/BeyondCombineReducers.html">Beyond `combineReducers`</a></li><li class="chapter-item "><a href="../../recipes/reducers/ImmutableUpdatePatterns.html">Immutable Update Patterns</a></li><li class="chapter-item "><a href="../../recipes/reducers/InitializingState.html">Initializing State</a></li><li class="chapter-item "><a href="../../recipes/reducers/NormalizingStateShape.html">Normalizing State Shape</a></li><li class="chapter-item "><a href="../../recipes/reducers/PrerequisiteConcepts.html">Prerequisite Reducer Concepts</a></li><li class="chapter-item "><a href="../../recipes/reducers/RefactoringReducersExample.html">Refactoring Reducer Logic Using Functional Decomposition and Reducer Composition</a></li><li class="chapter-item chapter-item-current"><a href="../../recipes/reducers/ReusingReducerLogic.html">Reusing Reducer Logic</a></li><li class="chapter-item "><a href="../../recipes/reducers/SplittingReducerLogic.html">Splitting Up Reducer Logic</a></li><li class="chapter-item "><a href="../../recipes/reducers/UpdatingNormalizedData.html">Managing Normalized Data</a></li><li class="chapter-item "><a href="../../recipes/reducers/UsingCombineReducers.html">Using `combineReducers`</a></li></ul><li class="chapter-item "><a href="../../faq/index.html">faq</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><li class="chapter-item "><a href="../../faq/Actions.html">Redux FAQ: Actions</a></li><li class="chapter-item "><a href="../../faq/CodeStructure.html">Redux FAQ: Code Structure</a></li><li class="chapter-item "><a href="../../faq/General.html">Redux FAQ: General</a></li><li class="chapter-item "><a href="../../faq/Miscellaneous.html">Redux FAQ: Miscellaneous</a></li><li class="chapter-item "><a href="../../faq/OrganizingState.html">Redux FAQ: Organizing State</a></li><li class="chapter-item "><a href="../../faq/Performance.html">Redux FAQ: Performance</a></li><li class="chapter-item "><a href="../../faq/ReactRedux.html">Redux FAQ: React Redux</a></li><li class="chapter-item "><a href="../../faq/Reducers.html">Redux FAQ: Reducers</a></li><li class="chapter-item "><a href="../../faq/StoreSetup.html">Redux FAQ: Store Setup</a></li></ul><li class="chapter-item "><a href="../../Troubleshooting.html">Troubleshooting</a></li><li class="chapter-item "><a href="../../Glossary.html">Glossary</a></li><li class="chapter-item "><a href="../../api/index.html">api</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item "><a href="../../api/Store.html">Store</a></li><li class="chapter-item "><a href="../../api/applyMiddleware.html">`applyMiddleware(...middlewares)`</a></li><li class="chapter-item "><a href="../../api/bindActionCreators.html">`bindActionCreators(actionCreators, dispatch)`</a></li><li class="chapter-item "><a href="../../api/combineReducers.html">`combineReducers(reducers)`</a></li><li class="chapter-item "><a href="../../api/compose.html">`compose(...functions)`</a></li><li class="chapter-item "><a href="../../api/createStore.html">`createStore(reducer, [preloadedState], [enhancer])`</a></li></ul><li class="chapter-item "><a href="../../Feedback.html">Feedback</a></li></ul>
</div>

<div class="columns content">
  <div class="column is-2-desktop is-3-widescreen is-hidden-touch">
  </div>
  <div class="column article-container is-11-tablet is-8-desktop is-6-widescreen">
    <div class="breadcrumb-area"><a href="../../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../../recipes/index.html" class="breadcrumb-item">recipes</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../../recipes/reducers/index.html" class="breadcrumb-item">reducers</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../../recipes/reducers/ReusingReducerLogic.html" class="breadcrumb-item">Reusing Reducer Logic</a></div>
    <h1 class="article-title">Reusing Reducer Logic</h1>
    <div class="article">
      <p>As an application grows, common patterns in reducer logic will start to emerge.  You may find several parts of your reducer logic doing the same kinds of work for different types of data, and want to reduce duplication by reusing the same common logic for each data type.  Or, you may want to have multiple &quot;instances&quot; of a certain type of data being handled in the store.  However, the global structure of a Redux store comes with some trade-offs: it makes it easy to track the overall state of an application, but can also make it harder to &quot;target&quot; actions that need to update a specific piece of state, particularly if you are using <code>combineReducers</code>.</p>
<p>As an example, let's say that we want to track multiple counters in our application, named A, B, and C.  We define our initial <code>counter</code> reducer, and we use <code>combineReducers</code> to set up our state:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">counter</span>(<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) </span>{
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'INCREMENT'</span>:
            <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'DECREMENT'</span>:
            <span class="hljs-keyword">return</span> state - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> state;
    }
}

<span class="hljs-keyword">const</span> rootReducer = combineReducers({
    <span class="hljs-attr">counterA</span> : counter,
    <span class="hljs-attr">counterB</span> : counter,
    <span class="hljs-attr">counterC</span> : counter
});
</code></pre>
<p>Unfortunately, this setup has a problem.  Because <code>combineReducers</code> will call each slice reducer with the same action, dispatching <code>{type : 'INCREMENT'}</code> will actually cause <em>all three</em> counter values to be incremented, not just one of them.  We need some way to wrap the <code>counter</code> logic so that we can ensure that only the counter we care about is updated.</p>
<h2 id="customizing-behavior-with-higher-order-reducers">Customizing Behavior with Higher-Order Reducers <a class="markdownIt-Anchor" href="#customizing-behavior-with-higher-order-reducers">#</a></h2>
<p>As defined in <a href="SplittingReducerLogic.md">Splitting Reducer Logic</a>, a <em>higher-order reducer</em> is a function that takes a reducer function as an argument, and/or returns a new reducer function as a result.  It can also be viewed as a &quot;reducer factory&quot;.  <code>combineReducers</code> is one example of a higher-order reducer.  We can use this pattern to create specialized versions of our own reducer functions, with each version only responding to specific actions.</p>
<p>The two most common ways to specialize a reducer are to generate new action constants with a given prefix or suffix, or to attach additional info inside the action object.  Here's what those might look like:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createCounterWithNamedType</span>(<span class="hljs-params">counterName = <span class="hljs-string">''</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">counter</span>(<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) </span>{
        <span class="hljs-keyword">switch</span> (action.type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">`INCREMENT_<span class="hljs-subst">${counterName}</span>`</span>:
                <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">`DECREMENT_<span class="hljs-subst">${counterName}</span>`</span>:
                <span class="hljs-keyword">return</span> state - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> state;
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createCounterWithNameData</span>(<span class="hljs-params">counterName = <span class="hljs-string">''</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">counter</span>(<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) </span>{
        <span class="hljs-keyword">const</span> {name} = action;
        <span class="hljs-keyword">if</span>(name !== counterName) <span class="hljs-keyword">return</span> state;
        
        <span class="hljs-keyword">switch</span> (action.type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">`INCREMENT`</span>:
                <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">`DECREMENT`</span>:
                <span class="hljs-keyword">return</span> state - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> state;
        }
    }
}
</code></pre>
<p>We should now be able to use either of these to generate our specialized counter reducers, and then dispatch actions that will affect the portion of the state that we care about:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> rootReducer = combineReducers({
    <span class="hljs-attr">counterA</span> : createCounterWithNamedType(<span class="hljs-string">'A'</span>),
    <span class="hljs-attr">counterB</span> : createCounterWithNamedType(<span class="hljs-string">'B'</span>),
    <span class="hljs-attr">counterC</span> : createCounterWithNamedType(<span class="hljs-string">'C'</span>),
});

store.dispatch({<span class="hljs-attr">type</span> : <span class="hljs-string">'INCREMENT_B'</span>});
<span class="hljs-built_in">console</span>.log(store.getState());
<span class="hljs-comment">// {counterA : 0, counterB : 1, counterC : 0}</span>
</code></pre>
<p>We could also vary the approach somewhat, and create a more generic higher-order reducer that accepts both a given reducer function and a name or identifier:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">counter</span>(<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) </span>{
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'INCREMENT'</span>:
            <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'DECREMENT'</span>:
            <span class="hljs-keyword">return</span> state - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> state;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createNamedWrapperReducer</span>(<span class="hljs-params">reducerFunction, reducerName</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> {name} = action;
        <span class="hljs-keyword">const</span> isInitializationCall = state === <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">if</span>(name !== reducerName &amp;&amp; !isInitializationCall) <span class="hljs-keyword">return</span> state;
        
        <span class="hljs-keyword">return</span> reducerFunction(state, action);    
    }
}

<span class="hljs-keyword">const</span> rootReducer = combineReducers({
    <span class="hljs-attr">counterA</span> : createNamedWrapperReducer(counter, <span class="hljs-string">'A'</span>),
    <span class="hljs-attr">counterB</span> : createNamedWrapperReducer(counter, <span class="hljs-string">'B'</span>),
    <span class="hljs-attr">counterC</span> : createNamedWrapperReducer(counter, <span class="hljs-string">'C'</span>),
});
</code></pre>
<p>You could even go as far as to make a generic filtering higher-order reducer:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createFilteredReducer</span>(<span class="hljs-params">reducerFunction, reducerPredicate</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> isInitializationCall = state === <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">const</span> shouldRunWrappedReducer = reducerPredicate(action) || isInitializationCall;
        <span class="hljs-keyword">return</span> shouldRunWrappedReducer ? reducerFunction(state, action) : state;
    }
}

<span class="hljs-keyword">const</span> rootReducer = combineReducers({
    <span class="hljs-comment">// check for suffixed strings</span>
    counterA : createFilteredReducer(counter, action =&gt; action.type.endsWith(<span class="hljs-string">'_A'</span>)),
    <span class="hljs-comment">// check for extra data in the action</span>
    counterB : createFilteredReducer(counter, action =&gt; action.name === <span class="hljs-string">'B'</span>),
    <span class="hljs-comment">// respond to all 'INCREMENT' actions, but never 'DECREMENT'</span>
    counterC : createFilteredReducer(counter, action =&gt; action.type === <span class="hljs-string">'INCREMENT'</span>)
};
</code></pre>
<p>These basic patterns allow you to do things like having multiple instances of a smart connected component within the UI, or reuse common logic for generic capabilities such as pagination or sorting.</p>

      
    </div>
    <div class="level article-bar is-mobile">
      <div class="level-item has-text-centered">
        <a title="previous page" class="previouse-article-link" href="../../recipes/reducers/RefactoringReducersExample.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a>
      </div>
      <div class="level-item has-text-centered">
        <a title="font size" class="link-item link-item-size">
          <span class="icon icon-size" data-icon="size"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="table of content" class="link-item link-item-toc">
          <span class="icon icon-toc" data-icon="toc"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="top" href="#">
          <span class="icon icon-up" data-icon="up"></span>
          <span class="link-content">â¤Š Top</span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="next page" class="next-article-link" href="../../recipes/reducers/SplittingReducerLogic.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a>
      </div>
    </div>
  </div>
  <div class="column is-2-widescreen is-hidden">
  </div>
</div>

<div class="columns foot">
  <div class="column is-3 is-offset-9 build-by">
    Build by Loppo 1.0.0
  </div>
</div>
<!-- SCRIPTS -->
<script>
  var LOPPO = {};
  LOPPO.current_path = 'recipes/reducers/ReusingReducerLogic.md';
  LOPPO.relative_root_path = '../../';
  LOPPO.article_toc = "<ul class=\"markdownIt-TOC\">\n<li><a href=\"#customizing-behavior-with-higher-order-reducers\">Customizing Behavior with Higher-Order Reducers</a></li>\n</ul>\n";
</script>
<script src="../../assets/js/app.js"></script>
</body>
</html>

